// Generated by CoffeeScript 1.3.3
/*
CustomerSectionBarView
@author Josh Bass
*/

define(["vendor/backbone", "plugins/CustomerSection/model/CustomerUpdatePanelModel", "plugins/CustomerSection/view/CustomerUpdatePanelView", "plugins/CustomerSection/view/Templates", 'css!plugins/CustomerSection/view/res/css/customerSection.css'], function(Backbone, CustomerUpdatePanelModel, CustomerUpdatePanelView, Templates, CSS) {
  return Backbone.View.extend({
    className: "customerSection",
    events: {
      "click .insertCustomerButton": "insertCustomerEvent"
    },
    initialize: function(model) {
      console.log("I am the customer section!!!");
      this.customerUpdateModel = new CustomerUpdatePanelModel();
      return this.customerUpdateView = new CustomerUpdatePanelView({
        model: this.customerUpdateModel
      });
    },
    /*
    		Create the Dialog and return its element
    		@method render
    */

    render: function() {
      var elem;
      this.$el.html(Templates.customerSection());
      elem = this.customerUpdateView.render();
      this.$el.find(".contentDiv").append(elem);
      elem.draggable();
      elem.css("position", "absolute");
      this.customerUpdateView.toggleHidden(false);
      return this.$el;
    },
    /*
    		Called after Dialog has been appended, this will set up the prog search
    		list with all known searches
    		@method realized
    */

    realized: function() {
      this.customerUpdateView.realized();
      return this.populateTable();
    },
    populateTable: function() {
      var _this = this;
      return $.get("users_by_last_name", {}, function(data) {
        var row, table, _i, _len, _ref, _results;
        table = _this.$el.find(".customerTable table");
        _ref = data.rows;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          row = _ref[_i];
          _results.push(table.append("<tr>" + "<td>" + row.value.last_name + "</td>" + "<td>" + row.value.first_name + "</td>" + "<td>" + row.value.nick_name + "</td>" + "<td>" + row.value.email + "</td>" + "<td>" + row.value.country + "</td>" + "<td>" + row.value.birthday + "</td>" + "<td> <button>" + "Edit" + "</button> </td>" + "<td> <button>" + "Delete" + "</button> </td>" + "</tr>"));
        }
        return _results;
      });
    },
    insertCustomerEvent: function() {
      return this.customerUpdateView.toggleHidden(true, true);
    }
  });
});
